<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-latest.js"></script>
<script>
$(function(){
	$("#qty").change(function(){
		var qty = $("#qty").val();
		$("#tot").html(qty * [[${goodsCommand.goodsPrice}]]);
	});
	$("#wishBtn").click(function(){
		if([[${session.authInfo == null}]]) {
			alert("로그인을 하셔야 합니다.");
			location.href="/";
			return false;
		}else {
			$.ajax({
				type : "post",
				url : "/cart/goodsWishAdd",
				dataType : "text",
				data : {"goodsNum" : "[[${goodsCommand.goodsNum}]]"},
				success : function(result){
					if(result.trim() == "1") {
						$("#wishBtn").attr("src", "/static/images/right_arrow.png");
						alert("관심상품에 등록되었습니다.");
					}else if(result.trim() == "0") {
						$("#wishBtn").attr("src", "/static/images/left_arrow.png");
						alert("관심상품이 삭제되었습니다.");
					}
				},
				error : function() {
					alert("로그아웃되었습니다. \n 다시 로그인해주세요.");
					location.href="/";
					return false;
				}
			});
		}
	});
	
	$("#cartAdd").click(function(){
		$.ajax({
			type : "post",
			url : "/cart/goodsCartAdd",
			dataType : "text",
			data : {"goodsNum" : "[[${goodsCommand.goodsNum}]]", "goodsQty" : $("#qty").val()},
			success : function(result){
				if(result.trim() == "1") {
					if(confirm("계속 쇼핑하시려면 '아니오'를 누르시오.")) {
						location.href="/cart/goodsCartList";
					}
				}else {
					alert("장바구니에 담기지 않았습니다. \n다시 시도해주세요.");
				}
			},
			error : function(){
				alert("error!!!");
				return;
			}
		});
	});
	
	$("#review").click(function(){
		$.ajax({
			type : "post",
			url : "/corner/reviewList",
			dataType : "html",
			data : {"goodsNum" : "[[${goodsCommand.goodsNum}]]"},
			success : function(result){
				$("#notice").html(result);
			},
			error : function(){
				alert("error!!!");
				return;
			}
		});
	});

/*
	$("#inquire").click(function(){
		$.ajax({
			type : "post",
			url : "/corner/inquireList",
			dataType : "html",
			data : {"goodsNum" : "[[${goodsCommand.goodsNum}]]"},
			success : function(result){
				$("#notice").html(result);
			},
			error : function(){
				alert("error!!!");
				return;
			}
		});
	});
*/
});

function inquire() {
	$.ajax({
		type : "post",
		url : "/corner/inquireList",
		dataType : "html",
		data : {"goodsNum" : "[[${goodsCommand.goodsNum}]]"},
		success : function(result){
			$("#notice").html(result);
		},
		error : function(){
			alert("error!!!");
			return;
		}
	});
}
</script>
</head>
<body>
<form action="#" name="frm" method="post">
<table border="1" width="800" align="center">
	<tr>
		<td colspan="2">[[${goodsCommand.goodsName}]] 상품 설명입니다.</td>
	</tr>
	<tr>
		<td rowspan="6" >
			<img height="500" width="500" th:src="|/goods/upload/${goodsCommand.goodsMain}|" />
		</td>
		<td width="300">[[${goodsCommand.goodsName}]] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 관심상품<img src="/static/images/left_arrow.png" id="wishBtn" >
		</td>
	</tr>
	<tr>
		<td align="left">가격 : [[${#numbers.formatCurrency(goodsCommand.goodsPrice)}]]원</td>
	</tr>
	<tr>
		<td align="left">배송비 : 
			<span th:if="${goodsCommand.deliveryCost == 0}" th:text="무료배송"></span>
			<span th:if="${goodsCommand.deliveryCost != 0}" th:text="${goodsCommand.deliveryCost}"></span>원
		</td>
	</tr>
	<tr>
		<td align="left">수량 :
			<input type="number" size="3" min="1" name="purchaseQty" value="1" id="qty" onChange="onQty();"/>
			[[${#numbers.formatCurrency(goodsCommand.goodsPrice)}]]원
		</td>
	</tr>
	<tr>
		<td align="left">총 상품 금액 : &nbsp;&nbsp;
			<span id="tot">[[${goodsCommand.goodsPrice}]]</span>원
		</td>
	</tr>
	<tr>
		<td align="center">
			<input type="button" value="장바구니" id="cartAdd" />
			<input type="submit" value="바로구매" />
		</td>
	</tr>
	<tr>
		<td colspan="2">
		제품 상세 설명
			<p>
				<span th:utext="${#strings.replace(goodsCommand.goodsContent, newLineChar, '&lt;br /&gt;')}"></span>
			<p>
			<th:block th:each="goodsImage : ${#strings.arraySplit(goodsCommand.goodsImages,'`')}">
				<img height="500" th:src="|/goods/upload/${goodsImage}|"/><br />
			</th:block>
		</td>
	</tr>
</table>
</form>
<table width="850" align="left">
<tr>
	<td>
	<ul>
		<li><span id="review">리뷰</span></li>
		<li><span id="inquire" onclick="inquire();">상품문의</span></li>
	</ul>
	<span id="notice">
	</span>
	</td>
</tr>
</table>

</body>
</html>